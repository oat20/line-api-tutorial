import{INIT_FAILED as t,INVALID_CONFIG as r,CREDENTIAL_KEYS as n,PERMANENT_LINK_ORIGIN as e}from"@liff/consts";import{createLiffError as i}from"@liff/util";import{getContext as a,getConfig as o}from"@liff/store";var s=function(){function s(){var s=this;this.extraParams="",this.getAndValidateContext=function(){var r=a();if(!r)throw i(t,"Could not get Context from server.");if(!r.endpointUrl)throw i(t,"Could not get endpointUrl from server.");if(!r.permanentLinkPattern)throw i(t,"Could not get permanentLinkPattern from server.");return r},this.createUrl=function(){var t=s.getAndValidateContext(),a=window.location,f=a.pathname,u=a.search,l=a.hash,h=a.origin,m=new URL(t.endpointUrl);if(m.origin!==h||!s.isAncestor(m.pathname,f))throw i(r,"Current page is not under entrypoint.");var c=f.substring(m.pathname.length);c.length>0&&"/"!==c[0]&&(c="/"+c);var p=new RegExp("^"+n.join("|")),g=l.substring(1).split("&").filter((function(t){return!p.test(t)&&Boolean(t)})).join("&"),d=g===m.hash.substring(1)?"":g,x=function(t){return t.substring(1).split("&").filter((function(t){return!/liff\.state/.test(t)&&Boolean(t)}))},v=x(u),P=x(m.search);s.extraParams&&v.push(s.extraParams);for(var w=0;w<P.length;w++){var b=P[w],C=v.indexOf(b);C>-1&&v.splice(C,1)}var U=v.join("&"),y=c+(""!==U?"?"+U:"")+(d?"#"+d:"");return""+e+o().liffId+y},this.setExtraQueryParam=function(t){s.extraParams=t},this.isAncestor=function(t,r){return 0===r.indexOf(t)&&(t.endsWith("/")&&(t=t.substring(0,t.length-1)),void 0===r[t.length]||"/"===r[t.length])},this.install=function(){return{createUrl:s.createUrl,setExtraQueryParam:s.setExtraQueryParam}}}return Object.defineProperty(s.prototype,"name",{get:function(){return"permanentLink"},enumerable:!1,configurable:!0}),s}(),f=new s;export{s as PermanentLink,f as module};
