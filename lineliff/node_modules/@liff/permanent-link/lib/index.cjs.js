"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@liff/consts"),t=require("@liff/util"),r=require("@liff/store"),n=function(){function n(){var n=this;this.extraParams="",this.getAndValidateContext=function(){var n=r.getContext();if(!n)throw t.createLiffError(e.INIT_FAILED,"Could not get Context from server.");if(!n.endpointUrl)throw t.createLiffError(e.INIT_FAILED,"Could not get endpointUrl from server.");if(!n.permanentLinkPattern)throw t.createLiffError(e.INIT_FAILED,"Could not get permanentLinkPattern from server.");return n},this.createUrl=function(){var i=n.getAndValidateContext(),a=window.location,o=a.pathname,s=a.search,f=a.hash,u=a.origin,l=new URL(i.endpointUrl);if(l.origin!==u||!n.isAncestor(l.pathname,o))throw t.createLiffError(e.INVALID_CONFIG,"Current page is not under entrypoint.");var c=o.substring(l.pathname.length);c.length>0&&"/"!==c[0]&&(c="/"+c);var h=new RegExp("^"+e.CREDENTIAL_KEYS.join("|")),g=f.substring(1).split("&").filter((function(e){return!h.test(e)&&Boolean(e)})).join("&"),p=g===l.hash.substring(1)?"":g,d=function(e){return e.substring(1).split("&").filter((function(e){return!/liff\.state/.test(e)&&Boolean(e)}))},m=d(s),x=d(l.search);n.extraParams&&m.push(n.extraParams);for(var I=0;I<x.length;I++){var E=x[I],L=m.indexOf(E);L>-1&&m.splice(L,1)}var v=m.join("&"),P=c+(""!==v?"?"+v:"")+(p?"#"+p:"");return""+e.PERMANENT_LINK_ORIGIN+r.getConfig().liffId+P},this.setExtraQueryParam=function(e){n.extraParams=e},this.isAncestor=function(e,t){return 0===t.indexOf(e)&&(e.endsWith("/")&&(e=e.substring(0,e.length-1)),void 0===t[e.length]||"/"===t[e.length])},this.install=function(){return{createUrl:n.createUrl,setExtraQueryParam:n.setExtraQueryParam}}}return Object.defineProperty(n.prototype,"name",{get:function(){return"permanentLink"},enumerable:!1,configurable:!0}),n}(),i=new n;exports.PermanentLink=n,exports.module=i;
